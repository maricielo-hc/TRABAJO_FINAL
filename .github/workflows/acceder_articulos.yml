name: Actualizar Articulos

on:
  schedule:
    - cron: '0 */12 * * *'  # Cada 12 horas
  workflow_dispatch:

jobs:
  actualizar:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar el repositorio
        uses: actions/checkout@v3

      - name: Instalar dependencias del sistema (Chrome y ChromeDriver)
        run: |
          sudo apt-get update
          sudo apt-get install -y wget unzip xvfb
          
          # Instalar Google Chrome
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt install -y ./google-chrome-stable_current_amd64.deb
          
          # Descargar ChromeDriver compatible
          CHROME_VERSION=$(google-chrome --version | cut -d ' ' -f 3 | cut -d '.' -f 1)
          DRIVER_VERSION=$(wget -qO- "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_$CHROME_VERSION")
          wget "https://chromedriver.storage.googleapis.com/${DRIVER_VERSION}/chromedriver_linux64.zip"
          unzip chromedriver_linux64.zip
          sudo mv chromedriver /usr/local/bin/
          sudo chmod +x /usr/local/bin/chromedriver

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Instalar librerÃ­as necesarias sin requirements.txt
        run: |
          pip install --upgrade pip
          pip install selenium beautifulsoup4

      - name: Ejecutar el script para actualizar noticias
        run: |
          xvfb-run python scripts/acceder_articulos.py

      - name: Subir cambios si los hay
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add js/articulos.js
          git commit -m "ðŸ”„ ActualizaciÃ³n automÃ¡tica de noticias cada 12h" || echo "Sin cambios"
          git push
